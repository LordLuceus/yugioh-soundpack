<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Dienstag, Juli 25, 2017, 5:38  -->
<!-- MuClient version 5.05 -->

<!-- Plugin "Callback_Caller" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Callback_Caller"
   author="Toni Barth"
   id="16a069a0403cb4490f4fe788"
   language="Lua"
   purpose="provides hooks to get informed on plugin callbacks even in simple world scripts"
   save_state="n"
   date_written="2017-07-25 17:36:33"
   requires="5.05"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Script  -->


<script>
<![CDATA[

Callbacks = {}
PPI = require('ppi')
Table = require('pl.tablex')

function OnPluginInstall()
  PPI.Expose('Hook', Hook)
  PPI.Expose('Unhook', Unhook)
end

function Hook(event, cb)
  event = event:lower()
  if Callbacks[event] == nil then
    Callbacks[event] = {}
  end
  if Table.find(Callbacks[event], cb) ~= nil then
    return false
  end
  Callbacks[event][#Callbacks[event]] = cb
  return true
end

function Unhook(event, cb)
  event = event:lower()
  if Callbacks[event] == nil then
    return false
  end
  local index = Table.find(Callbacks[event], cb)

  if index ~= nil then
    Callbacks[event] = Table.removevalues(Callbacks[event], index, index)
    return true
  end
  return false
end

function OnPluginTick()

  if Callbacks.tick == nil then
    return
  end

  for i = 1, #Callbacks.tick, 1 do
    Callbacks.tick[i]()
  end

end

]]>
</script>


</muclient>
