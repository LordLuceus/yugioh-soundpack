<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Freitag, Juli 28, 2017, 12:55  -->
<!-- MuClient version 5.05 -->

<!-- Plugin "Configuration" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Configuration"
   author="Toni Barth"
   id="741d5052da64c6ec33c863e5"
   language="Lua"
   purpose="A configuration tool which stores configuration data inside an ini file and makes stuff configurable"
   save_state="n"
   date_written="2017-07-28 12:54:55"
   requires="5.05"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Script  -->


<script>
<![CDATA[
Config = {}
Ini = require('ini')
PPI = require('ppi')
Table = require('pl.tablex')

function Load()

    local ctbl = Ini.read('config.dat')

  if ctbl then
    for name, section in pairs(ctbl) do
      for optionname, optionvalue in pairs(section) do
        config = tonumber(optionvalue)
        if config == nil then
          config = optionvalue
        end
        if Config[name] == nil then
          Config[name] = {}
        end
        Config[name][optionname] = config
      end
    end
  end

end

function Unload()
  if Table.size(Config) > 0 then
    Ini.write('config.dat', Config)
  end

end

function OnPluginClose()

  Unload()

end

function Set(section, option, value)

  if Config[section] == nil then
    Config[section] = {}
  end

  Config[section][option] = value

end

function Get(section, option)

  if Config[section] == nil then
    return nil
  end

  return Config[section][option]

end

PPI.Expose('Get', Get)
PPI.Expose('Load', Load)
PPI.Expose('Set', Set)
PPI.Expose('Unload', Unload)

]]>
</script>


</muclient>
